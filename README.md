# Mafia CRM 2.0

Современное CRM-приложение на Vue 3 для управления клиентами юридической команды. Интерфейс построен на Vue 3 c Composition API, данные могут храниться в Supabase или в локальном JSON-файле.

## Основные возможности

- **Vue 3 SPA** с живым поиском, статистикой и подробной карточкой клиента.
- Управление стадиями дел с подэтапами, задачами, платежами и обновлениями.
- Локальное кеширование в `localStorage` и резервный JSON-файл `data/clients.json` на сервере.
- Синхронизация с Supabase (при наличии `SUPABASE_KEY`) с автоматическим удалением неактуальных записей.
- Vite-конфигурация с проксированием API, быстрая разработка и production-сборка.

## Быстрый старт

```bash
npm install
```

### Запуск в режиме разработки

В отдельном терминале запустите backend (нужен для API):

```bash
npm run server
```

Затем стартуйте Vite:

```bash
npm run dev
```

Приложение откроется на `http://localhost:5173`. В дев-режиме все запросы `/api/*` проксируются на `http://localhost:3000`.

> Если Supabase недоступен, приложение автоматически подставит данные из `localStorage` или из файла `data/clients.json`.

### Production-сборка и запуск

```bash
npm run build
npm start
```

Команда `npm start` запускает Node-сервер, который обслуживает содержимое папки `dist` и API.

## Переменные окружения

| Переменная | Назначение | Значение по умолчанию |
|------------|------------|------------------------|
| `SUPABASE_KEY` | Секретный ключ Supabase (service role). При отсутствии данные сохраняются в `data/clients.json`. | — |
| `SUPABASE_URL` | URL проекта Supabase. | `https://zktbasskylvqprofkinb.supabase.co` |
| `PORT` | Порт Node-сервера. | `3000` |
| `VITE_PROXY_TARGET` | Целевой адрес API при разработке (прокси Vite). | `http://localhost:3000` |
| `VITE_API_BASE_URL` | Базовый URL API для фронтенда. Можно оставить пустым при использовании прокси или запуска в production на одном домене. | пусто |

## Структура проекта

```
├── data/clients.json         # Резервный JSON-файл с клиентами
├── src/
│   ├── App.vue               # Главный компонент приложения
│   ├── assets/main.css       # Стили интерфейса
│   ├── constants/stages.js   # Стадии и подэтапы дел
│   ├── data/sampleClients.js # Демо-данные
│   ├── services/clientService.js # Работа с API
│   ├── utils/clients.js      # Утилиты по работе с клиентами
│   └── utils/id.js           # Генерация идентификаторов
├── server.js                 # Node-сервер (Supabase + статика)
├── vite.config.js            # Конфигурация Vite
└── README.md
```

## Импорт/экспорт данных

- В production данные читаются через Supabase (если настроен ключ) или из `data/clients.json`.
- Любые изменения в клиенте автоматически сохраняются в `localStorage`. Кнопка «Синхронизировать» отправляет весь список клиентов на сервер.

## Дополнительные замечания

- Для добавления новых стадий измените `src/constants/stages.js` — интерфейс подстроится автоматически.
- Если вы разрабатываете без Supabase, не удаляйте файл `data/clients.json` — сервер будет использовать его для хранения данных.
- После сборки (`npm run build`) вся статика попадает в `dist/`; сервер автоматически раздаёт эту папку.

Приятной работы!
